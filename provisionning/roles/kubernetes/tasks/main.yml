---
- name: Add apt-key for k8s
  apt_key: url=https://packages.cloud.google.com/apt/doc/apt-key.gpg

- name: Add k8s repo
  apt_repository: repo='deb http://apt.kubernetes.io/ kubernetes-xenial main'

- name: Install packages
  apt: pkg={{item}} state=present update_cache=yes
  with_items:
    - docker.io
    - kubelet
    - kubeadm
    - kubectl
    - kubernetes-cni

- name: add ubuntu to docker group
  user: name=ubuntu groups=docker append=yes

- name: ensure service is running
  service: name={{item}} state=started enabled=yes
  with_items:
    - docker
    - kubelet